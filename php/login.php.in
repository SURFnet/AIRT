<?php
/* $Id$
 * login.php - allows users to log in to this site. 
 * vim: syntax=php tabstop=3 shiftwidth=3

 * AIRT: APPLICATION FOR INCIDENT RESPONSE TEAMS
 * Copyright (C) 2004,2005	Tilburg University, The Netherlands

 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.

 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.

 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
$public=1;
require_once 'config.plib';
require_once LIBDIR."/authentication.plib";
require_once LIBDIR."/airt.plib";

if (array_key_exists('action', $_REQUEST)) {
   $action=$_REQUEST['action'];
} else {
   $action = "none";
}

switch ($action) {
   case "none":
      pageHeader(_('AIRT login page'));
      $out = '<form method="POST">'.LF;
      $out .= '<table>'.LF;
      $out .= '<tr>'.LF;
      $out .= '   <td>'._('Login').'</td>'.LF;
      $out .= '   <td><input type="text" name="login" size="25"></td>'.LF;
      $out .= '</tr>'.LF;
      $out .= '<tr>'.LF;
      $out .= '   <td>'._('Password').'</td>'.LF;
      $out .= '   <td><input type="password" name="password" size="25"></td>'.LF;
      $out .= '</tr>'.LF;
      $out .= '</table>'.LF;
      print $out;

      generateEvent('loginscreen');

      $out = '<p><input type="hidden" name="action" value="check">'.LF;
      $out .= '<input type="submit" value="'._('Log in').'">'.LF;
      $out .= '</form></p>'.LF;
      $out .= '<HR/>'.LF;
      $out .= '<BLOCKQUOTE><small>'.LF;
      $out .= _('AIRT version @VERSION@, Copyright (C) 2004-2006 Tilburg University ').LF;
      $out .= '&lt;<a href="mailto:info@airt.nl">airt-dev@uvt.nl</a>&gt;<BR/>'.LF;
      $out .= _('AIRT comes with ABSOLUTELY NO WARRANTY; for details <a href="license.php">click here</a>.').'<BR/>'.LF;
      $out .= _('This is free software, and you are welcome to redistribute it under certain conditions; See the license for more details.').LF;
      $out .= '</small></BLOCKQUOTE>'.LF;

      print $out;
    break;

    case "check":
       $login = fetchFrom('REQUEST', 'login');
       if (empty($login)) {
          airt_error("PARAM_MISSING", "login.php:".__LINE__);
          reload();
          break;
       }

       $password = fetchFrom('REQUEST', 'password');
       if (empty($password)) {
          airt_error("PARAM_MISSING", "login.php:".__LINE__);
          reload();
          break;
       }

       $userid = airt_authenticate($login, $password);
       if ($userid == -1) {
          pageHeader(_('Permission denied.'));
          print _('Username and/or password incorrect.');
			 airt_invalidCredentials();
          pageFooter();
			 exit();
		 }

		 airt_initSession($userid);
       break;

    default:
       die(_('Unknown action.'));
} // switch
?>
